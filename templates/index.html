<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/static/results-page-styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Activity Planner</title>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08); /* Light blue */
  --color-bg-2: rgba(245, 158, 11, 0.08); /* Light yellow */
  --color-bg-3: rgba(34, 197, 94, 0.08); /* Light green */
  --color-bg-4: rgba(239, 68, 68, 0.08); /* Light red */
  --color-bg-5: rgba(147, 51, 234, 0.08); /* Light purple */
  --color-bg-6: rgba(249, 115, 22, 0.08); /* Light orange */
  --color-bg-7: rgba(236, 72, 153, 0.08); /* Light pink */
  --color-bg-8: rgba(6, 182, 212, 0.08); /* Light cyan */

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    /* RGB versions for opacity control (Dark Mode) */
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
    --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
    --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
    --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
    --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
    --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
    --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
    --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --button-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* Common style patterns - updated for dark mode */
    --focus-ring: 0 0 0 3px var(--color-focus-ring);
    --focus-outline: 2px solid var(--color-primary);
    --status-bg-opacity: 0.15;
    --status-border-opacity: 0.25;
    --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

/* Data attribute for manual theme switching */
[data-color-scheme="dark"] {
  /* RGB versions for opacity control (dark mode) */
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;

  /* Colorful background palette - Dark Mode */
  --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
  --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
  --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
  --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
  --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
  --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
  --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
  --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

  /* Semantic Color Tokens (Dark Mode) */
  --color-background: var(--color-charcoal-700);
  --color-surface: var(--color-charcoal-800);
  --color-text: var(--color-gray-200);
  --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
  --color-primary: var(--color-teal-300);
  --color-primary-hover: var(--color-teal-400);
  --color-primary-active: var(--color-teal-800);
  --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
  --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
  --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
  --color-border: rgba(var(--color-gray-400-rgb), 0.3);
  --color-error: var(--color-red-400);
  --color-success: var(--color-teal-300);
  --color-warning: var(--color-orange-400);
  --color-info: var(--color-gray-300);
  --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
  --color-btn-primary-text: var(--color-slate-900);
  --color-card-border: rgba(var(--color-gray-400-rgb), 0.15);
  --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
  --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

  /* Common style patterns - updated for dark mode */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for dark mode */
  --color-success-rgb: var(--color-teal-300-rgb);
  --color-error-rgb: var(--color-red-400-rgb);
  --color-warning-rgb: var(--color-orange-400-rgb);
  --color-info-rgb: var(--color-gray-300-rgb);
}

[data-color-scheme="light"] {
  /* RGB versions for opacity control (light mode) */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

  /* RGB versions for light mode */
  --color-success-rgb: var(--color-teal-500-rgb);
  --color-error-rgb: var(--color-red-500-rgb);
  --color-warning-rgb: var(--color-orange-500-rgb);
  --color-info-rgb: var(--color-slate-500-rgb);
}

/* Base styles */
html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}
h4 {
  font-size: var(--font-size-xl);
}
h5 {
  font-size: var(--font-size-lg);
}
h6 {
  font-size: var(--font-size-md);
}

p {
  margin: 0 0 var(--space-16) 0;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--duration-fast) var(--ease-standard);
}

a:hover {
  color: var(--color-primary-hover);
}

code,
pre {
  font-family: var(--font-family-mono);
  font-size: calc(var(--font-size-base) * 0.95);
  background-color: var(--color-secondary);
  border-radius: var(--radius-sm);
}

code {
  padding: var(--space-1) var(--space-4);
}

pre {
  padding: var(--space-16);
  margin: var(--space-16) 0;
  overflow: auto;
  border: 1px solid var(--color-border);
}

pre code {
  background: none;
  padding: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--secondary:active {
  background: var(--color-secondary-active);
}

.btn--outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text);
}

.btn--outline:hover {
  background: var(--color-secondary);
}

.btn--sm {
  padding: var(--space-4) var(--space-12);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-sm);
}

.btn--lg {
  padding: var(--space-10) var(--space-20);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-md);
}

.btn--full-width {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Form elements */
.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

textarea.form-control {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
}

select.form-control {
  padding: var(--space-8) var(--space-12);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

/* Add a dark mode specific caret */
@media (prefers-color-scheme: dark) {
  select.form-control {
    background-image: var(--select-caret-dark);
  }
}

/* Also handle data-color-scheme */
[data-color-scheme="dark"] select.form-control {
  background-image: var(--select-caret-dark);
}

[data-color-scheme="light"] select.form-control {
  background-image: var(--select-caret-light);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

/* Card component */
.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.card:hover {
  box-shadow: var(--shadow-md);
}

.card__body {
  padding: var(--space-16);
}

.card__header,
.card__footer {
  padding: var(--space-16);
  border-bottom: 1px solid var(--color-card-border-inner);
}

/* Status indicators - simplified with CSS variables */
.status {
  display: inline-flex;
  align-items: center;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.status--success {
  background-color: rgba(
    var(--color-success-rgb, 33, 128, 141),
    var(--status-bg-opacity)
  );
  color: var(--color-success);
  border: 1px solid
    rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
}

.status--error {
  background-color: rgba(
    var(--color-error-rgb, 192, 21, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-error);
  border: 1px solid
    rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
}

.status--warning {
  background-color: rgba(
    var(--color-warning-rgb, 168, 75, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-warning);
  border: 1px solid
    rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
}

.status--info {
  background-color: rgba(
    var(--color-info-rgb, 98, 108, 113),
    var(--status-bg-opacity)
  );
  color: var(--color-info);
  border: 1px solid
    rgba(var(--color-info-rgb, 98, 108, 113), var(--status-border-opacity));
}

/* Container layout */
.container {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--space-16);
  padding-left: var(--space-16);
}

@media (min-width: 640px) {
  .container {
    max-width: var(--container-sm);
  }
}
@media (min-width: 768px) {
  .container {
    max-width: var(--container-md);
  }
}
@media (min-width: 1024px) {
  .container {
    max-width: var(--container-lg);
  }
}
@media (min-width: 1280px) {
  .container {
    max-width: var(--container-xl);
  }
}

/* Utility classes */
.flex {
  display: flex;
}
.flex-col {
  flex-direction: column;
}
.items-center {
  align-items: center;
}
.justify-center {
  justify-content: center;
}
.justify-between {
  justify-content: space-between;
}
.gap-4 {
  gap: var(--space-4);
}
.gap-8 {
  gap: var(--space-8);
}
.gap-16 {
  gap: var(--space-16);
}

.m-0 {
  margin: 0;
}
.mt-8 {
  margin-top: var(--space-8);
}
.mb-8 {
  margin-bottom: var(--space-8);
}
.mx-8 {
  margin-left: var(--space-8);
  margin-right: var(--space-8);
}
.my-8 {
  margin-top: var(--space-8);
  margin-bottom: var(--space-8);
}

.p-0 {
  padding: 0;
}
.py-8 {
  padding-top: var(--space-8);
  padding-bottom: var(--space-8);
}
.px-8 {
  padding-left: var(--space-8);
  padding-right: var(--space-8);
}
.py-16 {
  padding-top: var(--space-16);
  padding-bottom: var(--space-16);
}
.px-16 {
  padding-left: var(--space-16);
  padding-right: var(--space-16);
}

.block {
  display: block;
}
.hidden {
  display: none;
}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
}

/* Dark mode specifics */
[data-color-scheme="dark"] .btn--outline {
  border: 1px solid var(--color-border-secondary);
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

/* Member Card Styles */
.member-card {
    transition: all var(--duration-normal) var(--ease-standard);
}

.member-card:hover {
    transform: translateY(-2px);
}

.ability-badge {
    display: inline-flex;
    align-items: center;
    padding: var(--space-4) var(--space-8);
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-medium);
}

.ability-beginner {
    background: rgba(var(--color-warning-rgb), 0.15);
    color: var(--color-warning);
    border: 1px solid rgba(var(--color-warning-rgb), 0.25);
}

.ability-intermediate {
    background: rgba(var(--color-info-rgb), 0.15);
    color: var(--color-info);
    border: 1px solid rgba(var(--color-info-rgb), 0.25);
}

.ability-advanced {
    background: rgba(var(--color-success-rgb), 0.15);
    color: var(--color-success);
    border: 1px solid rgba(var(--color-success-rgb), 0.25);
}

.range-value {
    display: inline-block;
    min-width: 20px;
    text-align: center;
    font-weight: var(--font-weight-medium);
    color: var(--color-primary);
}

/* Custom App Styles */
.app-header {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-12) 0;
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-main {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-24);
  min-height: 60px;
}

.nav-menu {
  display: flex;
  align-items: center;
  gap: var(--space-24);
  list-style: none;
  margin: 0;
  padding: 0;
  height: 60px;
}

.nav-menu li {
  display: flex;
  align-items: center;
  height: 100%;
}

.nav-user {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  height: 60px;
}

.nav-brand {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}



.nav-link {
  color: var(--color-text);
  font-weight: var(--font-weight-medium);
  padding: var(--space-8) var(--space-12);
  border-radius: var(--radius-base);
  transition: all var(--duration-fast) var(--ease-standard);
}

.nav-link:hover {
  background: var(--color-secondary);
  color: var(--color-primary);
}

.nav-link.active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}



.search-section {
  padding: var(--space-32) 0;
  background: var(--color-bg-1);
}

.search-hero {
  text-align: center;
  margin-bottom: var(--space-32);
}

.search-hero h1 {
  font-size: var(--font-size-4xl);
  margin-bottom: var(--space-16);
}

.search-hero p {
  font-size: var(--font-size-lg);
  color: var(--color-text-secondary);
  max-width: 600px;
  margin: 0 auto;
}

.search-bar {
  position: relative;
  max-width: 600px;
  margin: var(--space-24) auto;
}

.search-input {
  padding: var(--space-12) var(--space-16);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-lg);
  border: 2px solid var(--color-border);
  transition: border-color var(--duration-fast) var(--ease-standard);
}

.search-input:focus {
  border-color: var(--color-primary);
}

.main-content {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: var(--space-32);
  padding: var(--space-32) 0;
  min-height: 500px;
}

.filters-sidebar {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  height: fit-content;
  position: sticky;
  top: 120px;
}

.filter-group {
  margin-bottom: var(--space-24);
}

.filter-group h3 {
  font-size: var(--font-size-md);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.filter-toggle {
  display: flex;
  gap: var(--space-8);
}

.toggle-btn {
  padding: var(--space-6) var(--space-12);
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  border-radius: var(--radius-base);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.toggle-btn.active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

.range-slider {
  width: 100%;
  margin: var(--space-8) 0;
}

.activities-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: var(--space-24);
}

.activity-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  transition: all var(--duration-normal) var(--ease-standard);
}

.activity-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.activity-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-12);
}

.activity-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin: 0;
}

.activity-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
  margin-bottom: var(--space-16);
}

.meta-badge {
  display: inline-flex;
  align-items: center;
  padding: var(--space-4) var(--space-8);
  background: var(--color-bg-2);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
}

.activity-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-6);
  margin-bottom: var(--space-16);
}

.tag {
  padding: var(--space-2) var(--space-8);
  background: var(--color-secondary);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

.activity-actions {
  display: flex;
  gap: var(--space-8);
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  z-index: 1000;
  box-shadow: var(--shadow-lg);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-20);
  position: relative;
}

.modal-close {
  background: none;
  border: none;
  font-size: var(--font-size-2xl);
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-12);
  border-radius: var(--radius-base);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  position: relative;
  z-index: 1001;
  transition: all var(--duration-fast) var(--ease-standard);
  min-width: 44px;
  min-height: 44px;
}

.modal-close:hover {
  background: var(--color-secondary-hover);
  color: var(--color-text);
  transform: scale(1.05);
}

.modal-close:active {
  background: var(--color-secondary-hover);
  transform: scale(0.95);
}

.modal-close:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-16);
}

.form-group-full {
  grid-column: 1 / -1;
}

.view {
  display: none;
}

.view.active {
  display: block;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: var(--color-border);
  border-radius: var(--radius-base);
  overflow: hidden;
}

.calendar-header {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  padding: var(--space-12);
  text-align: center;
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-sm);
}

.calendar-day {
  background: var(--color-surface);
  padding: var(--space-12);
  min-height: 120px;
  border-right: 1px solid var(--color-border);
  border-bottom: 1px solid var(--color-border);
}

.day-number {
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-8);
}

.day-activities {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.calendar-activity {
  background: var(--color-bg-3);
  padding: var(--space-4) var(--space-6);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  cursor: pointer;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.stat-card {
  background: var(--color-surface);
  padding: var(--space-16);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  text-align: center;
}

.stat-number {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--space-4);
}

.stat-label {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .nav-menu {
    display: none;
  }
  
  .main-content {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }
  
  .filters-sidebar {
    position: static;
  }
  
  .activities-grid {
    grid-template-columns: 1fr;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .activity-actions {
    flex-direction: column;
  }
  
  /* My Group mobile styles */
  .modal {
    max-width: 95%;
    max-height: 95vh;
    margin: var(--space-8);
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .member-card .flex {
    flex-direction: column;
    gap: var(--space-4);
  }
  
  .member-card .btn {
    font-size: var(--font-size-xs);
    padding: var(--space-6) var(--space-8);
  }
}

@media (max-width: 768px) {
  /* My Group tablet styles */
  .activities-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .modal {
    max-width: 90%;
  }
  
  /* Hide nickname and some details on smaller cards */
  .member-card .secondary-info {
    display: none;
  }
}
    </style>
</head>
<body>
    <div id="main-page">
    <!-- Header Navigation -->
    <header class="app-header">
        <div class="container">
            <nav class="nav-main">
                <div class="nav-brand">Family Activity Planner</div>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-view="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-view="search">Search</a></li>
                    <li><a href="#" class="nav-link" data-view="calendar">My Plan</a></li>
                    <li><a href="#" class="nav-link" data-view="my-group" id="myGroupNavLink">My Group</a></li>
                    <li><a href="#" class="nav-link" data-view="add-activity">Add Activity</a></li>
                    <li><a href="#" class="nav-link" data-view="profile">Profile</a></li>
                </ul>
                <div class="nav-user">
                    <a href="#" class="btn btn--outline btn--sm nav-link" data-view="login" id="loginNavBtn">Login</a>
                    <div id="guestInfo" class="hidden" style="display: flex; align-items: center; gap: var(--space-8);">
                        <span class="status status--info" style="position: relative; cursor: pointer;" id="guestBadge">
                            👤 Guest Mode
                            <div id="guestTooltip" class="hidden" style="position: absolute; top: 100%; right: 0; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-base); padding: var(--space-8); font-size: var(--font-size-sm); white-space: nowrap; z-index: 1000; box-shadow: var(--shadow-md);">
                                You're using guest mode. Data will not be saved after session ends.
                            </div>
                        </span>
                        <a href="#" class="btn btn--outline btn--sm nav-link" data-view="login">Login/Register</a>
                    </div>
                    <div id="userInfo" class="hidden">
                        <span id="userName">Sarah Johnson</span>
                        <button class="btn btn--outline btn--sm" id="logoutBtn">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Home View -->
    <div id="home" class="view active">
        <section class="search-section">
            <div class="container">
                <div class="search-hero">
                    <h1>Discover Amazing Family Activities</h1>
                    <p>Find the perfect activities for your family with our intelligent search and planning tools. From outdoor adventures to creative indoor projects.</p>
                </div>
                <div class="search-bar">
                    <input type="text" class="form-control search-input" placeholder="Search for family activities..." id="mainSearchInput">
                </div>
            </div>
        </section>

        <section class="container">
            <h2 style="margin-bottom: var(--space-24);">Featured Activities</h2>
            <div class="activities-grid" id="featuredActivities"></div>
        </section>
    </div>

    <!-- Search View -->
    <div id="search" class="view">
        <div class="container">
            <div class="main-content">
                <!-- Filters Sidebar -->
                <aside class="filters-sidebar">
                    <div class="filter-group">
                        <h3>Age Range</h3>
                        <label class="form-label">Min Age: <span id="minAgeValue">4</span></label>
                        <input type="range" class="range-slider" id="minAge" min="2" max="18" value="4">
                        <label class="form-label">Max Age: <span id="maxAgeValue">12</span></label>
                        <input type="range" class="range-slider" id="maxAge" min="2" max="18" value="12">
                    </div>

                    <div class="filter-group">
                        <h3>Duration</h3>
                        <select class="form-control" id="durationFilter">
                            <option value="">Any Duration</option>
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">1 hour</option>
                            <option value="120">2+ hours</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <h3>Cost</h3>
                        <select class="form-control" id="costFilter">
                            <option value="">Any Cost</option>
                            <option value="Free">Free</option>
                            <option value="$1-10">Low cost ($1-10)</option>
                            <option value="$11-25">Medium cost ($11-25)</option>
                            <option value="$25+">High cost ($25+)</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <h3>Location</h3>
                        <div class="filter-toggle">
                            <button class="toggle-btn active" data-filter="indoor_outdoor" data-value="">All</button>
                            <button class="toggle-btn" data-filter="indoor_outdoor" data-value="Indoor">Indoor</button>
                            <button class="toggle-btn" data-filter="indoor_outdoor" data-value="Outdoor">Outdoor</button>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h3>Season</h3>
                        <select class="form-control" id="seasonFilter">
                            <option value="">All Seasons</option>
                            <option value="Spring">Spring</option>
                            <option value="Summer">Summer</option>
                            <option value="Fall">Fall</option>
                            <option value="Winter">Winter</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <h3>Number of Players</h3>
                        <input type="number" class="form-control" id="playersFilter" placeholder="Any number" min="1">
                    </div>
                </aside>

                <!-- Search Results -->
                <main>
                    <div style="margin-bottom: var(--space-24);">
                        <input type="text" class="form-control" placeholder="Search activities..." id="searchInput">
                    </div>
                    <div id="searchResults">
                        <div class="activities-grid" id="activitiesGrid"></div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Add Activity View -->
    <div id="add-activity" class="view">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <h1>Add New Activity</h1>
                <p class="mb-8">Share your favorite family activity with our community!</p>
                
                <form id="addActivityForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Activity Title *</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Duration (minutes) *</label>
                            <input type="number" class="form-control" name="duration" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Min Age *</label>
                            <input type="number" class="form-control" name="age_min" min="1" max="18" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max Age *</label>
                            <input type="number" class="form-control" name="age_max" min="1" max="18" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Cost Range *</label>
                            <select class="form-control" name="cost" required>
                                <option value="">Select cost range</option>
                                <option value="Free">Free</option>
                                <option value="$1-10">$1-10</option>
                                <option value="$11-25">$11-25</option>
                                <option value="$25+">$25+</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location *</label>
                            <select class="form-control" name="indoor_outdoor" required>
                                <option value="">Select location</option>
                                <option value="Indoor">Indoor</option>
                                <option value="Outdoor">Outdoor</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Number of Players</label>
                            <input type="text" class="form-control" name="players" placeholder="e.g., 2-6">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Seasons (hold Ctrl/Cmd for multiple)</label>
                            <select class="form-control" name="season" multiple>
                                <option value="Spring">Spring</option>
                                <option value="Summer">Summer</option>
                                <option value="Fall">Fall</option>
                                <option value="Winter">Winter</option>
                            </select>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label class="form-label">Tags (comma-separated)</label>
                            <input type="text" class="form-control" name="tags" placeholder="outdoor, nature, exploration, learning">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label class="form-label">Materials Needed *</label>
                            <textarea class="form-control" name="materials" rows="3" placeholder="List all materials needed for this activity..." required></textarea>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label class="form-label">How to Play / Instructions *</label>
                            <textarea class="form-control" name="instructions" rows="6" placeholder="Provide step-by-step instructions..." required></textarea>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label class="form-label">Parent Caution Notes</label>
                            <textarea class="form-control" name="caution" rows="2" placeholder="Any safety notes or cautions for parents..."></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-16" style="margin-top: var(--space-24);">
                        <button type="button" class="btn btn--secondary" id="saveDraftBtn">Save Draft</button>
                        <button type="submit" class="btn btn--primary">Submit Activity</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Calendar View -->
    <div id="calendar" class="view">
        <div class="container">
            <div class="flex justify-between items-center" style="margin-bottom: var(--space-24);">
                <h1>My Activity Plan</h1>
                <div class="flex gap-8">
                    <button class="btn btn--outline btn--sm" id="exportPdfBtn" onclick="exportToPDF()">Export PDF</button>
                    <button class="btn btn--outline btn--sm" id="exportCsvBtn" onclick="exportToCSV()">Export CSV</button>
                    <button class="btn btn--outline btn--sm" id="exportIcsBtn" onclick="exportToICS()">Export ICS</button>
                </div>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-header">Sunday</div>
                <div class="calendar-header">Monday</div>
                <div class="calendar-header">Tuesday</div>
                <div class="calendar-header">Wednesday</div>
                <div class="calendar-header">Thursday</div>
                <div class="calendar-header">Friday</div>
                <div class="calendar-header">Saturday</div>
                
                <!-- Sample calendar days -->
                <div class="calendar-day">
                    <div class="day-number">15</div>
                    <div class="day-activities">
                        <div class="calendar-activity">Nature Hunt (2 PM)</div>
                    </div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">16</div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">17</div>
                    <div class="day-activities">
                        <div class="calendar-activity">Art Gallery (10 AM)</div>
                        <div class="calendar-activity">Kitchen Science (3 PM)</div>
                    </div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">18</div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">19</div>
                    <div class="day-activities">
                        <div class="calendar-activity">Obstacle Course (11 AM)</div>
                    </div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">20</div>
                </div>
                <div class="calendar-day">
                    <div class="day-number">21</div>
                    <div class="day-activities">
                        <div class="calendar-activity">Backyard Camping (6 PM)</div>
                    </div>
                </div>
                
                <!-- Add more days as needed -->
                <div class="calendar-day"><div class="day-number">22</div></div>
                <div class="calendar-day"><div class="day-number">23</div></div>
                <div class="calendar-day"><div class="day-number">24</div></div>
                <div class="calendar-day"><div class="day-number">25</div></div>
                <div class="calendar-day"><div class="day-number">26</div></div>
                <div class="calendar-day"><div class="day-number">27</div></div>
                <div class="calendar-day"><div class="day-number">28</div></div>
            </div>
        </div>
    </div>

    <!-- Member Form View -->
    <div id="member-form" class="view">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Breadcrumb -->
                <div style="margin-bottom: var(--space-24); font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                    <a href="#" onclick="showView('my-group')" style="color: var(--color-primary);">My Group</a> > 
                    <span id="memberFormBreadcrumb">Add Member</span>
                </div>
                
                <h1 id="memberFormTitle">Add New Member</h1>
                
                <form id="memberPageForm" style="margin-top: var(--space-32);">
                    <!-- All the member form content from the modal -->
                    <!-- Basic Information -->
                    <div style="margin-bottom: var(--space-24);">
                        <h4 style="margin-bottom: var(--space-16); color: var(--color-primary);">Basic Information</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nickname</label>
                                <input type="text" class="form-control" name="nickname">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date of Birth *</label>
                                <input type="date" class="form-control" name="date_of_birth" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gender</label>
                                <select class="form-control" name="gender">
                                    <option value="">Prefer not to say</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Physical Characteristics -->
                    <div style="margin-bottom: var(--space-24);">
                        <h4 style="margin-bottom: var(--space-16); color: var(--color-primary);">Physical Characteristics</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Height (cm) *</label>
                                <input type="number" class="form-control" name="height_cm" min="50" max="250" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Weight (kg) *</label>
                                <input type="number" class="form-control" name="weight_kg" min="5" max="200" step="0.1" required>
                            </div>
                            <div class="form-group form-group-full">
                                <label class="form-label">BMI (calculated automatically)</label>
                                <input type="text" class="form-control" name="bmi" readonly style="background: var(--color-secondary);">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Abilities & Skills -->
                    <div style="margin-bottom: var(--space-24);">
                        <h4 style="margin-bottom: var(--space-16); color: var(--color-primary);">Abilities &amp; Skills</h4>
                        <div class="form-group">
                            <label class="form-label">Overall Physical Ability Level (1-10) *</label>
                            <input type="range" class="range-slider" name="overall_ability" min="1" max="10" value="5" required>
                            <div style="display: flex; justify-content: space-between; font-size: var(--font-size-xs); color: var(--color-text-secondary);">
                                <span>Beginner</span>
                                <span>Intermediate</span>
                                <span>Expert</span>
                            </div>
                        </div>
                        
                        <h5 style="margin: var(--space-16) 0 var(--space-8) 0;">Motor Skills</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Fine Motor Skills (1-10)</label>
                                <input type="range" class="range-slider" name="fine_motor" min="1" max="10" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gross Motor Skills (1-10)</label>
                                <input type="range" class="range-slider" name="gross_motor" min="1" max="10" value="5">
                            </div>
                        </div>
                        
                        <h5 style="margin: var(--space-16) 0 var(--space-8) 0;">Physical Capabilities</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Endurance Level (1-10)</label>
                                <input type="range" class="range-slider" name="endurance" min="1" max="10" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Strength Level (1-10)</label>
                                <input type="range" class="range-slider" name="strength" min="1" max="10" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Flexibility Level (1-10)</label>
                                <input type="range" class="range-slider" name="flexibility" min="1" max="10" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Balance &amp; Coordination (1-10)</label>
                                <input type="range" class="range-slider" name="balance" min="1" max="10" value="5">
                            </div>
                        </div>
                        
                        <h5 style="margin: var(--space-16) 0 var(--space-8) 0;">Cognitive Abilities</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Reading Level</label>
                                <select class="form-control" name="reading_level">
                                    <option value="Pre-reader">Pre-reader</option>
                                    <option value="Beginning">Beginning</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Math Skills</label>
                                <select class="form-control" name="math_skills">
                                    <option value="Basic counting">Basic counting</option>
                                    <option value="Simple arithmetic">Simple arithmetic</option>
                                    <option value="Advanced math">Advanced math</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Problem-solving Skills (1-10)</label>
                                <input type="range" class="range-slider" name="problem_solving" min="1" max="10" value="5">
                            </div>
                        </div>
                        
                        <h5 style="margin: var(--space-16) 0 var(--space-8) 0;">Social Skills</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Group Interaction Comfort (1-10)</label>
                                <input type="range" class="range-slider" name="group_interaction" min="1" max="10" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Leadership Tendency (1-10)</label>
                                <input type="range" class="range-slider" name="leadership" min="1" max="10" value="5">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Special Considerations -->
                    <div style="margin-bottom: var(--space-24);">
                        <h4 style="margin-bottom: var(--space-16); color: var(--color-primary);">Special Considerations</h4>
                        <div class="form-group">
                            <label class="form-label">Disabilities/Special Needs</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-8); margin-bottom: var(--space-8);">
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="special_needs" value="Mobility limitations"> Mobility limitations
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="special_needs" value="Visual impairment"> Visual impairment
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="special_needs" value="Hearing impairment"> Hearing impairment
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="special_needs" value="Autism spectrum"> Autism spectrum
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="special_needs" value="ADHD"> ADHD
                                </label>
                            </div>
                            <input type="text" class="form-control" name="other_special_needs" placeholder="Other (please specify)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Allergies</label>
                            <textarea class="form-control" name="allergies" rows="2" placeholder="List any allergies..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medical Conditions</label>
                            <textarea class="form-control" name="medical_conditions" rows="2" placeholder="Any relevant medical conditions..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Interests & Preferences -->
                    <div style="margin-bottom: var(--space-24);">
                        <h4 style="margin-bottom: var(--space-16); color: var(--color-primary);">Interests &amp; Preferences</h4>
                        <div class="form-group">
                            <label class="form-label">Favorite Activity Types (select multiple)</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-8);">
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Sports & Physical Activities"> Sports &amp; Physical Activities
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Arts & Crafts"> Arts &amp; Crafts
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Science & Exploration"> Science &amp; Exploration
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Music & Performance"> Music &amp; Performance
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Reading & Storytelling"> Reading &amp; Storytelling
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Building & Construction"> Building &amp; Construction
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Nature & Outdoors"> Nature &amp; Outdoors
                                </label>
                                <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                    <input type="checkbox" name="interests" value="Technology & Gaming"> Technology &amp; Gaming
                                </label>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Activity Preference</label>
                                <select class="form-control" name="activity_preference">
                                    <option value="Both">Both Indoor &amp; Outdoor</option>
                                    <option value="Indoor">Prefer Indoor</option>
                                    <option value="Outdoor">Prefer Outdoor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Energy Level</label>
                                <select class="form-control" name="energy_level">
                                    <option value="Low">Low</option>
                                    <option value="Moderate">Moderate</option>
                                    <option value="High">High</option>
                                    <option value="Very High">Very High</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-16" style="margin-top: var(--space-32); padding-top: var(--space-16); border-top: 1px solid var(--color-border);">
                        <button type="button" class="btn btn--secondary" onclick="showView('my-group')">Cancel</button>
                        <button type="submit" class="btn btn--primary">Save Member</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Activity Details View -->
    <div id="activity-details" class="view">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Breadcrumb -->
                <div style="margin-bottom: var(--space-24); font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                    <a href="#" onclick="showView('search')" style="color: var(--color-primary);">Search</a> > 
                    <span id="activityDetailsBreadcrumb">Activity Details</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: var(--space-16); margin-bottom: var(--space-24);">
                    <button class="btn btn--outline btn--sm" onclick="showView('search')">← Back</button>
                    <h1 id="activityDetailsTitle">Activity Details</h1>
                </div>
                
                <div id="activityDetailsContent">
                    <!-- Content populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- My Group View -->
    <div id="my-group" class="view">
        <div class="container">
            <div class="flex justify-between items-center" style="margin-bottom: var(--space-32);">
                <div>
                    <h1>My Family Group</h1>
                    <p style="color: var(--color-text-secondary); margin: 0;">Add group members to get personalized activity recommendations</p>
                </div>
                <button class="btn btn--primary" onclick="showView('member-form')">
                    + Add New Member
                </button>
            </div>
            
            <!-- Quick Add Member Templates -->
            <div style="margin-bottom: var(--space-32);">
                <h2 style="margin-bottom: var(--space-16);">Quick Add Member Templates</h2>
                <p style="color: var(--color-text-secondary); margin-bottom: var(--space-24);">Choose from pre-configured member types to quickly add to your group. You can edit the details after adding.</p>
                
                <div class="activities-grid" id="memberTemplatesGrid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
                    <!-- Template: Toddler -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">👶</div>
                        <h4 style="margin-bottom: var(--space-8);">Toddler</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">2-3 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Low abilities, basic motor skills, pre-reader</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_toddler')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Preschooler -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">🧒</div>
                        <h4 style="margin-bottom: var(--space-8);">Preschooler</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">4-5 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Developing abilities, improving motor skills, learning basics</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_preschooler')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Early Elementary -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">👧</div>
                        <h4 style="margin-bottom: var(--space-8);">Early Elementary</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">6-8 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Intermediate abilities, good coordination, beginning reader</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_early_elem')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Late Elementary -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">🧑</div>
                        <h4 style="margin-bottom: var(--space-8);">Late Elementary</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">9-11 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Advanced abilities, strong skills, proficient reader</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_late_elem')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Preteen -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">👦</div>
                        <h4 style="margin-bottom: var(--space-8);">Preteen</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">12-14 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Expert level, excellent physical abilities, advanced learner</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_preteen')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Teen -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">🧑‍🎓</div>
                        <h4 style="margin-bottom: var(--space-8);">Teen</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">15-17 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Peak physical abilities, mature cognitive skills, independent</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_teen')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Adult Supervisor -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">👨‍👩</div>
                        <h4 style="margin-bottom: var(--space-8);">Adult Supervisor</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">25-45 years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Supervising role, full abilities</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_adult')">Quick Add</button>
                    </div>
                    
                    <!-- Template: Senior -->
                    <div class="card" style="padding: var(--space-16); text-align: center;">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-12);">👴</div>
                        <h4 style="margin-bottom: var(--space-8);">Senior</h4>
                        <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-8);">65+ years</p>
                        <p style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-bottom: var(--space-16);">Moderate abilities, some limitations, experienced</p>
                        <button class="btn btn--primary btn--sm" onclick="addMemberTemplate('template_senior')">Quick Add</button>
                    </div>
                </div>
            </div>
            
            <!-- Group Summary -->
            <div class="card" style="margin-bottom: var(--space-32);">
                <div class="card__body">
                    <h3 style="margin-bottom: var(--space-16);">Group Summary</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalMembers">0</div>
                            <div class="stat-label">Total Members</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="ageRange">-</div>
                            <div class="stat-label">Age Range</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgAbility">-</div>
                            <div class="stat-label">Avg Ability Level</div>
                        </div>
                        <div class="stat-card">
                            <button class="btn btn--primary btn--sm" id="getRecommendationsBtn" disabled>Get Recommendations</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ML Features Explanation -->
            <div class="card" style="margin-bottom: var(--space-32); background: var(--color-bg-1);">
                <div class="card__body">
                    <h3 style="margin-bottom: var(--space-16);">How We Use Your Group Data</h3>
                    <p style="margin-bottom: var(--space-16); color: var(--color-text-secondary);">Our hybrid search system combines keyword matching (BM25), semantic understanding (Sentence-BERT), and neural re-ranking to provide personalized recommendations.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-16);">
                        <div style="display: flex; align-items: center; gap: var(--space-8);">
                            <span style="font-size: var(--font-size-2xl);">👶</span>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);">Age Matching</div>
                                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Filters activities within appropriate age ranges</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-8);">
                            <span style="font-size: var(--font-size-2xl);">💪</span>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);">Ability Scoring</div>
                                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Ranks activities by difficulty match</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-8);">
                            <span style="font-size: var(--font-size-2xl);">⚕️</span>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);">Safety First</div>
                                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Excludes activities conflicting with allergies or special needs</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-8);">
                            <span style="font-size: var(--font-size-2xl);">🎯</span>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);">Interest Alignment</div>
                                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Boosts activities matching group preferences</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-8);">
                            <span style="font-size: var(--font-size-2xl);">👥</span>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);">Group Optimization</div>
                                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Finds activities suitable for all members</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Group Members Grid -->
            <div id="groupMembersSection">
                <h3 style="margin-bottom: var(--space-16);">Family Members</h3>
                <div id="emptyState" class="card" style="text-align: center; padding: var(--space-32);">
                    <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-16);">👨‍👩‍👧‍👦</div>
                    <h4 style="margin-bottom: var(--space-8);">No group members yet</h4>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--space-16);">Add your first member to start getting personalized recommendations!</p>
                    <button class="btn btn--primary" onclick="document.getElementById('addMemberBtn').click()">Add First Member</button>
                </div>
                <div class="activities-grid" id="membersGrid" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Profile View -->
    <div id="profile" class="view">
        <div class="container">
            <h1>My Profile</h1>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">12</div>
                    <div class="stat-label">Activities Contributed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">8</div>
                    <div class="stat-label">Activities Planned</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">245</div>
                    <div class="stat-label">Community Points</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">March 2024</div>
                    <div class="stat-label">Member Since</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-32);">
                <div class="card">
                    <div class="card__body">
                        <h3>Recent Submissions</h3>
                        <ul style="list-style: none; padding: 0; margin: var(--space-16) 0 0 0;">
                            <li style="padding: var(--space-8) 0; border-bottom: 1px solid var(--color-border);">Garden Treasure Map <span class="status status--success">Approved</span></li>
                            <li style="padding: var(--space-8) 0; border-bottom: 1px solid var(--color-border);">Rainy Day Dance Party <span class="status status--warning">Under Review</span></li>
                            <li style="padding: var(--space-8) 0;">Build a Fort Challenge <span class="status status--info">Draft</span></li>
                        </ul>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card__body">
                        <h3>Account Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" value="Sarah Johnson">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" value="sarah.johnson@email.com">
                        </div>
                        <button class="btn btn--primary">Update Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Login/Register Page -->
    <div id="login" class="view">
        <div class="container">
            <div style="max-width: 400px; margin: 0 auto; padding-top: var(--space-32);">
                <!-- App Logo -->
                <div style="text-align: center; margin-bottom: var(--space-32);">
                    <div class="nav-brand" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-8);">Family Activity Planner</div>
                    <p style="color: var(--color-text-secondary);">Welcome back! Please sign in to your account.</p>
                </div>
                
                <!-- Login/Register Tabs -->
                <div class="auth-tabs" style="display: flex; margin-bottom: var(--space-24); border-bottom: 1px solid var(--color-border);">
                    <button class="auth-tab active" data-tab="login" style="flex: 1; padding: var(--space-12); border: none; background: none; font-weight: var(--font-weight-medium); cursor: pointer; border-bottom: 2px solid var(--color-primary); color: var(--color-primary);">Login</button>
                    <button class="auth-tab" data-tab="register" style="flex: 1; padding: var(--space-12); border: none; background: none; font-weight: var(--font-weight-medium); cursor: pointer; border-bottom: 2px solid transparent; color: var(--color-text-secondary);">Register</button>
                </div>
                
                <!-- Login Form -->
                <div id="loginTabContent" class="auth-content">
                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                <input type="checkbox" id="rememberMe"> Remember me
                            </label>
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width" style="margin-bottom: var(--space-16);">Login</button>
                        <div style="text-align: center; margin-bottom: var(--space-16);">
                            <a href="#" style="font-size: var(--font-size-sm); color: var(--color-primary);">Forgot password?</a>
                        </div>
                        
                        <!-- Divider -->
                        <div style="text-align: center; margin: var(--space-24) 0; position: relative;">
                            <span style="background: var(--color-background); padding: 0 var(--space-16); color: var(--color-text-secondary); font-size: var(--font-size-sm);">OR</span>
                            <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--color-border); z-index: -1;"></div>
                        </div>
                        
                        <!-- Social Login -->
                        <div style="display: flex; flex-direction: column; gap: var(--space-8);">
                            <button type="button" class="btn btn--outline btn--full-width" style="display: flex; align-items: center; justify-content: center; gap: var(--space-8);">Continue with Google</button>
                            <button type="button" class="btn btn--outline btn--full-width" style="display: flex; align-items: center; justify-content: center; gap: var(--space-8);">Continue with Facebook</button>
                        </div>
                    </form>
                </div>
                
                <!-- Register Form -->
                <div id="registerTabContent" class="auth-content hidden">
                    <form id="registerForm">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="registerName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: var(--space-8); font-size: var(--font-size-sm);">
                                <input type="checkbox" id="agreeTerms" required> I agree to <a href="#" style="color: var(--color-primary);">Terms &amp; Conditions</a>
                            </label>
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width" style="margin-bottom: var(--space-16);">Create Account</button>
                        
                        <!-- Divider -->
                        <div style="text-align: center; margin: var(--space-24) 0; position: relative;">
                            <span style="background: var(--color-background); padding: 0 var(--space-16); color: var(--color-text-secondary); font-size: var(--font-size-sm);">OR</span>
                            <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--color-border); z-index: -1;"></div>
                        </div>
                        
                        <!-- Social Signup -->
                        <div style="display: flex; flex-direction: column; gap: var(--space-8);">
                            <button type="button" class="btn btn--outline btn--full-width" style="display: flex; align-items: center; justify-content: center; gap: var(--space-8);">Sign up with Google</button>
                            <button type="button" class="btn btn--outline btn--full-width" style="display: flex; align-items: center; justify-content: center; gap: var(--space-8);">Sign up with Facebook</button>
                        </div>
                    </form>
                </div>
                
                <!-- Guest Mode Section -->
                <div style="text-align: center; margin: var(--space-32) 0; position: relative;">
                    <span style="background: var(--color-background); padding: 0 var(--space-16); color: var(--color-text-secondary); font-size: var(--font-size-sm);">OR</span>
                    <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--color-border); z-index: -1;"></div>
                </div>
                
                <!-- Continue as Guest Button -->
                <button type="button" class="btn btn--outline btn--full-width" id="continueAsGuestBtn" style="display: flex; align-items: center; justify-content: center; gap: var(--space-8); margin-bottom: var(--space-16);">
                    <span style="font-size: var(--font-size-lg);">👤</span>
                    Continue as Guest - No account needed
                </button>
                
                <!-- Switch Link -->
                <div style="text-align: center; margin-top: var(--space-24); padding-top: var(--space-24); border-top: 1px solid var(--color-border);">
                    <p id="switchText" style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">
                        Don't have an account? <a href="#" id="switchAuthMode" style="color: var(--color-primary); font-weight: var(--font-weight-medium);">Register</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample activities data - will be loaded from CSV
        let sampleActivities = [];

        // CSV parsing function
        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;

                const obj = {};
                const currentLine = parseCSVLine(lines[i]);

                for (let j = 0; j < headers.length; j++) {
                    const header = headers[j].trim();
                    let value = currentLine[j] ? currentLine[j].trim() : '';

                    // Parse special fields
                    if (header === 'age_min' || header === 'age_max' || header === 'duration_mins') {
                        value = parseInt(value) || 0;
                    } else if (header === 'tags' || header === 'materials_needed' || header === 'how_to_play') {
                        // Parse array fields - they come as JSON strings from CSV
                        try {
                            value = JSON.parse(value.replace(/'/g, '"'));
                            if (!Array.isArray(value)) value = [value];
                            // For how_to_play, join array into string
                            if (header === 'how_to_play') {
                                value = Array.isArray(value) ? value.join(' ') : value;
                            }
                        } catch (e) {
                            if (header === 'tags') {
                                value = value ? value.split(',').map(t => t.trim()) : [];
                            } else if (header === 'materials_needed') {
                                value = value ? [value] : [];
                            } else {
                                value = value || '';
                            }
                        }
                    } else if (header === 'season') {
                        // Handle season field
                        value = value.toLowerCase() === 'all' ? ['All seasons'] : [value];
                    } else if (header === 'cost') {
                        // Normalize cost field
                        if (value.toLowerCase() === 'free') value = 'Free';
                        else if (value.toLowerCase() === 'low') value = '$1-10';
                    } else if (header === 'indoor_outdoor') {
                        // Capitalize first letter
                        if (value.toLowerCase() === 'both') value = 'Both';
                        else value = value.charAt(0).toUpperCase() + value.slice(1).toLowerCase();
                    } else if (header === 'parent_caution') {
                        value = value === 'no' || value === '' ? '' : 'Parental supervision recommended';
                    }

                    obj[header] = value;
                }

                if (obj.title) result.push(obj);
            }

            return result;
        }

        // Helper function to parse CSV line accounting for quoted fields
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);

            return result;
        }

        // Load activities from CSV
        async function loadActivitiesFromCSV() {
            try {
                const response = await fetch('dataset/dataset empty -open space-.csv');
                const text = await response.text();
                sampleActivities = parseCSV(text);
                console.log(`Loaded ${sampleActivities.length} activities from CSV`);

                // Initialize the display
                currentActivities = [...sampleActivities];
                renderFeaturedActivities();
            } catch (error) {
                console.error('Error loading CSV:', error);
                // Fallback to empty array if CSV fails to load
                sampleActivities = [];
                alert('Could not load activities database. Please check that the dataset file exists.');
            }
        }

        // Export to ICS (iCalendar format)
        function exportToICS() {
            if (scheduledActivities.length === 0) {
                alert('No activities scheduled yet. Please add activities to your calendar first.');
                return;
            }

            let icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Family Activity Planner//EN',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'X-WR-CALNAME:Family Activities',
                'X-WR-TIMEZONE:UTC'
            ];

            scheduledActivities.forEach(event => {
                const startDate = new Date(event.date);
                const endDate = new Date(startDate.getTime() + (event.duration || 60) * 60000);

                icsContent.push(
                    'BEGIN:VEVENT',
                    `DTSTART:${formatICSDate(startDate)}`,
                    `DTEND:${formatICSDate(endDate)}`,
                    `SUMMARY:${event.title}`,
                    `DESCRIPTION:${event.description || event.how_to_play || ''}`,
                    `LOCATION:${event.indoor_outdoor || ''}`,
                    `UID:${event.id || Date.now()}@familyactivityplanner.com`,
                    `DTSTAMP:${formatICSDate(new Date())}`,
                    'END:VEVENT'
                );
            });

            icsContent.push('END:VCALENDAR');

            const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'family-activities.ics';
            link.click();

            console.log('ICS exported successfully');
        }

        // Helper function to format dates for ICS
        function formatICSDate(date) {
            const pad = (n) => n < 10 ? '0' + n : n;
            return date.getUTCFullYear() +
                   pad(date.getUTCMonth() + 1) +
                   pad(date.getUTCDate()) + 'T' +
                   pad(date.getUTCHours()) +
                   pad(date.getUTCMinutes()) +
                   pad(date.getUTCSeconds()) + 'Z';
        }

        // Export to CSV
        function exportToCSV() {
            if (scheduledActivities.length === 0) {
                alert('No activities scheduled yet. Please add activities to your calendar first.');
                return;
            }

            const headers = ['Date', 'Time', 'Activity', 'Duration (mins)', 'Age Range', 'Location', 'Cost', 'Materials', 'Instructions'];
            const rows = scheduledActivities.map(activity => {
                const date = new Date(activity.date);
                return [
                    date.toLocaleDateString(),
                    date.toLocaleTimeString(),
                    activity.title || '',
                    activity.duration_mins || '',
                    `${activity.age_min}-${activity.age_max}` || '',
                    activity.indoor_outdoor || '',
                    activity.cost || '',
                    Array.isArray(activity.materials_needed) ? activity.materials_needed.join('; ') : activity.materials_needed || '',
                    activity.how_to_play || ''
                ].map(field => `"${String(field).replace(/"/g, '""')}"`).join(',');
            });

            const csvContent = [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'family-activities-schedule.csv';
            link.click();

            console.log('CSV exported successfully');
        }

        // Export to PDF
        function exportToPDF() {
            if (scheduledActivities.length === 0) {
                alert('No activities scheduled yet. Please add activities to your calendar first.');
                return;
            }

            // Create a simple text-based PDF using a data URL approach
            const pdf = generatePDFContent();

            // For a real implementation, you'd use jsPDF library
            // For now, we'll create a printable HTML version
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Family Activities Schedule</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #21808D; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #21808D; color: white; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .activity-details { font-size: 0.9em; color: #666; margin-top: 5px; }
                        @media print {
                            button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1>Family Activities Schedule</h1>
                    <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    <button onclick="window.print()" style="padding: 10px 20px; background: #21808D; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">Print / Save as PDF</button>
                    ${pdf}
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function generatePDFContent() {
            let html = '<table>';
            html += '<thead><tr><th>Date & Time</th><th>Activity</th><th>Details</th></tr></thead>';
            html += '<tbody>';

            scheduledActivities
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .forEach(activity => {
                    const date = new Date(activity.date);
                    html += `
                        <tr>
                            <td>
                                <strong>${date.toLocaleDateString()}</strong><br>
                                ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </td>
                            <td>
                                <strong>${activity.title}</strong>
                                <div class="activity-details">
                                    Ages: ${activity.age_min}-${activity.age_max} |
                                    Duration: ${activity.duration_mins} mins |
                                    ${activity.indoor_outdoor}
                                </div>
                            </td>
                            <td>
                                <div class="activity-details">
                                    <strong>Cost:</strong> ${activity.cost}<br>
                                    ${activity.materials_needed ? `<strong>Materials:</strong> ${Array.isArray(activity.materials_needed) ? activity.materials_needed.join(', ') : activity.materials_needed}<br>` : ''}
                                    ${activity.how_to_play ? `<strong>Instructions:</strong> ${activity.how_to_play}` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                });

            html += '</tbody></table>';
            return html;
        }

        // Add activity to plan (schedule it)
        function addToPlan(activityTitle) {
            const activity = sampleActivities.find(a => a.title === activityTitle);
            if (!activity) return;

            // Prompt for date and time
            const dateStr = prompt('Enter date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
            if (!dateStr) return;

            const timeStr = prompt('Enter time (HH:MM):', '10:00');
            if (!timeStr) return;

            const dateTime = new Date(`${dateStr}T${timeStr}`);

            if (isNaN(dateTime.getTime())) {
                alert('Invalid date or time format');
                return;
            }

            // Add to scheduled activities
            const scheduledActivity = {
                ...activity,
                date: dateTime.toISOString(),
                id: Date.now() + Math.random()
            };

            scheduledActivities.push(scheduledActivity);


            // Render calendar if on calendar view
            renderCalendar();

            console.log('Activity scheduled:', scheduledActivity);
        }

        // Render dynamic calendar
        function renderCalendar() {
            const calendarGrid = document.querySelector('.calendar-grid');
            if (!calendarGrid) return;

            // Get current month
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();

            // Clear existing calendar (except headers)
            const headers = Array.from(calendarGrid.querySelectorAll('.calendar-header'));
            calendarGrid.innerHTML = '';
            headers.forEach(h => calendarGrid.appendChild(h));

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';

                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);

                // Check for scheduled activities on this day
                const dayDate = new Date(year, month, day);
                const dayActivities = scheduledActivities.filter(activity => {
                    const activityDate = new Date(activity.date);
                    return activityDate.getDate() === day &&
                           activityDate.getMonth() === month &&
                           activityDate.getFullYear() === year;
                });

                if (dayActivities.length > 0) {
                    const activitiesContainer = document.createElement('div');
                    activitiesContainer.className = 'day-activities';

                    dayActivities.forEach(activity => {
                        const activityDiv = document.createElement('div');
                        activityDiv.className = 'calendar-activity';
                        const time = new Date(activity.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        activityDiv.textContent = `${activity.title} (${time})`;
                        activityDiv.style.cursor = 'pointer';
                        activityDiv.onclick = () => viewScheduledActivity(activity.id);
                        activitiesContainer.appendChild(activityDiv);
                    });

                    dayElement.appendChild(activitiesContainer);
                }

                calendarGrid.appendChild(dayElement);
            }
        }

        // View scheduled activity details
        function viewScheduledActivity(activityId) {
            const activity = scheduledActivities.find(a => a.id === activityId);
            if (!activity) return;

            const date = new Date(activity.date);
            const confirmDelete = confirm(
                `${activity.title}\n\n` +
                `Date: ${date.toLocaleDateString()}\n` +
                `Time: ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\n` +
                `Duration: ${activity.duration_mins} mins\n\n` +
                `Click OK to remove this activity from your calendar`
            );

            if (confirmDelete) {
                scheduledActivities = scheduledActivities.filter(a => a.id !== activityId);
                renderCalendar();
            }
        }

        // Application state
        let currentActivities = [...sampleActivities];
        let isLoggedIn = false;
        let isGuestMode = false;
        let currentFilters = {};
        let groupMembers = [];
        window.groupMembers = groupMembers;
        let editingMemberId = null;
        let scheduledActivities = []; // Store scheduled activities with dates and times
        
        // Sample group members data
        const sampleGroupMembers = [
            {
                id: 1,
                name: "Emma Johnson",
                nickname: "Em",
                date_of_birth: "2015-06-15",
                age: 10,
                gender: "Female",
                height_cm: 140,
                weight_kg: 35,
                bmi: 17.9,
                overall_ability: 7,
                motor_skills: { fine: 8, gross: 7 },
                physical_capabilities: { endurance: 6, strength: 5, flexibility: 8, balance: 7 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Simple arithmetic", problem_solving: 7 },
                social_skills: { group_interaction: 8, leadership: 6 },
                special_needs: [],
                allergies: "Peanuts",
                medical_conditions: "",
                interests: ["Arts & Crafts", "Reading & Storytelling", "Nature & Outdoors"],
                activity_preference: "Both",
                energy_level: "Moderate"
            },
            {
                id: 2,
                name: "Lucas Johnson",
                nickname: "Luke",
                date_of_birth: "2018-03-22",
                age: 7,
                gender: "Male",
                height_cm: 122,
                weight_kg: 24,
                bmi: 16.1,
                overall_ability: 6,
                motor_skills: { fine: 5, gross: 8 },
                physical_capabilities: { endurance: 7, strength: 6, flexibility: 6, balance: 8 },
                cognitive_abilities: { reading_level: "Beginning", math_skills: "Basic counting", problem_solving: 5 },
                social_skills: { group_interaction: 7, leadership: 5 },
                special_needs: ["ADHD"],
                allergies: "",
                medical_conditions: "",
                interests: ["Sports & Physical Activities", "Building & Construction", "Nature & Outdoors"],
                activity_preference: "Outdoor",
                energy_level: "Very High"
            },
            {
                id: 3,
                name: "Sophie Johnson",
                nickname: "Soph",
                date_of_birth: "2020-11-08",
                age: 4,
                gender: "Female",
                height_cm: 102,
                weight_kg: 16,
                bmi: 15.4,
                overall_ability: 4,
                motor_skills: { fine: 4, gross: 5 },
                physical_capabilities: { endurance: 4, strength: 3, flexibility: 7, balance: 5 },
                cognitive_abilities: { reading_level: "Pre-reader", math_skills: "Basic counting", problem_solving: 3 },
                social_skills: { group_interaction: 6, leadership: 3 },
                special_needs: [],
                allergies: "Dairy",
                medical_conditions: "",
                interests: ["Arts & Crafts", "Music & Performance", "Reading & Storytelling"],
                activity_preference: "Indoor",
                energy_level: "Moderate"
            }
        ];

        // Member Templates Data
        const memberTemplates = {
            template_toddler: {
                id: "template_toddler",
                name: "Toddler",
                age_range: "2-3 years",
                age: 3,
                date_of_birth: "2022-01-15",
                gender: "Prefer not to say",
                height_cm: 95,
                weight_kg: 14,
                overall_ability: 2,
                motor_skills: { fine: 2, gross: 3 },
                physical_capabilities: { endurance: 2, strength: 2, flexibility: 5, balance: 3 },
                cognitive_abilities: { reading_level: "Pre-reader", math_skills: "Basic counting", problem_solving: 2 },
                social_skills: { group_interaction: 4, leadership: 2 },
                special_needs: [],
                allergies: "",
                interests: ["Arts & Crafts", "Music & Performance"],
                activity_preference: "Indoor",
                energy_level: "Moderate",
                icon: "👶"
            },
            template_preschooler: {
                id: "template_preschooler",
                name: "Preschooler",
                age_range: "4-5 years",
                age: 5,
                date_of_birth: "2020-06-01",
                gender: "Prefer not to say",
                height_cm: 108,
                weight_kg: 18,
                overall_ability: 4,
                motor_skills: { fine: 4, gross: 5 },
                physical_capabilities: { endurance: 4, strength: 3, flexibility: 6, balance: 5 },
                cognitive_abilities: { reading_level: "Pre-reader", math_skills: "Basic counting", problem_solving: 3 },
                social_skills: { group_interaction: 5, leadership: 3 },
                special_needs: [],
                allergies: "",
                interests: ["Arts & Crafts", "Nature & Outdoors", "Music & Performance"],
                activity_preference: "Both",
                energy_level: "High",
                icon: "🧒"
            },
            template_early_elem: {
                id: "template_early_elem",
                name: "Early Elementary",
                age_range: "6-8 years",
                age: 7,
                date_of_birth: "2018-03-15",
                gender: "Prefer not to say",
                height_cm: 122,
                weight_kg: 24,
                overall_ability: 6,
                motor_skills: { fine: 6, gross: 7 },
                physical_capabilities: { endurance: 6, strength: 5, flexibility: 7, balance: 7 },
                cognitive_abilities: { reading_level: "Beginning", math_skills: "Simple arithmetic", problem_solving: 5 },
                social_skills: { group_interaction: 7, leadership: 5 },
                special_needs: [],
                allergies: "",
                interests: ["Sports & Physical Activities", "Science & Exploration", "Building & Construction"],
                activity_preference: "Outdoor",
                energy_level: "Very High",
                icon: "👧"
            },
            template_late_elem: {
                id: "template_late_elem",
                name: "Late Elementary",
                age_range: "9-11 years",
                age: 10,
                date_of_birth: "2015-09-01",
                gender: "Prefer not to say",
                height_cm: 140,
                weight_kg: 35,
                overall_ability: 7,
                motor_skills: { fine: 8, gross: 8 },
                physical_capabilities: { endurance: 7, strength: 6, flexibility: 7, balance: 8 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Advanced math", problem_solving: 7 },
                social_skills: { group_interaction: 8, leadership: 7 },
                special_needs: [],
                allergies: "",
                interests: ["Science & Exploration", "Technology & Gaming", "Sports & Physical Activities"],
                activity_preference: "Both",
                energy_level: "High",
                icon: "🧑"
            },
            template_preteen: {
                id: "template_preteen",
                name: "Preteen",
                age_range: "12-14 years",
                age: 13,
                date_of_birth: "2012-05-20",
                gender: "Prefer not to say",
                height_cm: 158,
                weight_kg: 48,
                overall_ability: 8,
                motor_skills: { fine: 9, gross: 8 },
                physical_capabilities: { endurance: 8, strength: 7, flexibility: 7, balance: 8 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Advanced math", problem_solving: 8 },
                social_skills: { group_interaction: 8, leadership: 8 },
                special_needs: [],
                allergies: "",
                interests: ["Technology & Gaming", "Sports & Physical Activities", "Music & Performance"],
                activity_preference: "Both",
                energy_level: "High",
                icon: "👦"
            },
            template_teen: {
                id: "template_teen",
                name: "Teen",
                age_range: "15-17 years",
                age: 16,
                date_of_birth: "2009-02-10",
                gender: "Prefer not to say",
                height_cm: 170,
                weight_kg: 62,
                overall_ability: 9,
                motor_skills: { fine: 9, gross: 9 },
                physical_capabilities: { endurance: 9, strength: 8, flexibility: 7, balance: 9 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Advanced math", problem_solving: 9 },
                social_skills: { group_interaction: 8, leadership: 9 },
                special_needs: [],
                allergies: "",
                interests: ["Sports & Physical Activities", "Technology & Gaming", "Science & Exploration"],
                activity_preference: "Both",
                energy_level: "Very High",
                icon: "🧑‍🎓"
            },
            template_adult: {
                id: "template_adult",
                name: "Adult Supervisor",
                age_range: "25-45 years",
                age: 35,
                date_of_birth: "1990-07-15",
                gender: "Prefer not to say",
                height_cm: 170,
                weight_kg: 70,
                overall_ability: 8,
                motor_skills: { fine: 9, gross: 8 },
                physical_capabilities: { endurance: 7, strength: 7, flexibility: 6, balance: 8 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Advanced math", problem_solving: 9 },
                social_skills: { group_interaction: 9, leadership: 10 },
                special_needs: [],
                allergies: "",
                interests: ["Nature & Outdoors", "Sports & Physical Activities", "Arts & Crafts"],
                activity_preference: "Both",
                energy_level: "Moderate",
                icon: "👨‍👩"
            },
            template_senior: {
                id: "template_senior",
                name: "Senior",
                age_range: "65+ years",
                age: 70,
                date_of_birth: "1955-04-20",
                gender: "Prefer not to say",
                height_cm: 165,
                weight_kg: 68,
                overall_ability: 5,
                motor_skills: { fine: 7, gross: 5 },
                physical_capabilities: { endurance: 4, strength: 4, flexibility: 4, balance: 5 },
                cognitive_abilities: { reading_level: "Advanced", math_skills: "Advanced math", problem_solving: 9 },
                social_skills: { group_interaction: 9, leadership: 8 },
                special_needs: [],
                allergies: "",
                interests: ["Reading & Storytelling", "Nature & Outdoors", "Arts & Crafts"],
                activity_preference: "Both",
                energy_level: "Low",
                icon: "👴"
            }
        };
        
        // Template functions
        function addMemberTemplate(templateId) {
            const template = memberTemplates[templateId];
            if (!template) {
                alert('Template not found!');
                return;
            }
            
            // Create a new member from template with property mapping
            const memberCount = groupMembers.filter(m => m.name.includes(template.name)).length;
            const newMember = {
                ...template,
                id: Date.now(), // New unique ID
                name: memberCount > 0 ? `${template.name} ${memberCount + 1}` : template.name,
                bmi: calculateBMI(template.height_cm, template.weight_kg),
                medical_conditions: "",
                // Map overall_ability to ability for API compatibility
                ability: template.overall_ability,
                physical_ability: template.overall_ability
            };
            
            groupMembers.push(newMember);
            
            window.groupMembers = groupMembers;
            
            console.log('Added template member:', newMember);
            console.log('Total group members:', groupMembers.length);
            console.log('Total window.groupMembers:', window.groupMembers.length);

            renderGroupMembers();
        }

        // DOM elements
        const views = document.querySelectorAll('.view');
        const navLinks = document.querySelectorAll('.nav-link');
        const loginNavBtn = document.getElementById('loginNavBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');

        // Helper functions
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }
        
        function calculateBMI(heightCm, weightKg) {
            const heightM = heightCm / 100;
            return Math.round((weightKg / (heightM * heightM)) * 10) / 10;
        }
        
        function getAbilityLevelText(level) {
            if (level <= 2) return "Beginner";
            if (level <= 4) return "Developing";
            if (level <= 6) return "Intermediate";
            if (level <= 8) return "Advanced";
            return "Expert";
        }
        
        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase();
        }
        
        // Group member management
        function renderGroupMembers() {
            const grid = document.getElementById('membersGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (groupMembers.length === 0) {
                emptyState.style.display = 'block';
                grid.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                grid.style.display = 'grid';
                grid.innerHTML = groupMembers.map(member => createMemberCard(member)).join('');
            }
            
            updateGroupSummary();
        }
        
        function createMemberCard(member) {
            const abilityText = getAbilityLevelText(member.overall_ability);
            const abilityColorValues = member.overall_ability <= 4 ? '168, 75, 47' : member.overall_ability <= 7 ? '98, 108, 113' : '33, 128, 141';
            
            return `
                <div class="card member-card" style="padding: var(--space-16);">
                    <div style="display: flex; align-items: flex-start; gap: var(--space-12); margin-bottom: var(--space-16);">
                        <div style="width: 50px; height: 50px; border-radius: var(--radius-full); background: var(--color-primary); color: var(--color-btn-primary-text); display: flex; align-items: center; justify-content: center; font-weight: var(--font-weight-bold); font-size: var(--font-size-lg); flex-shrink: 0;">
                            ${getInitials(member.name)}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <h4 style="margin: 0 0 var(--space-4) 0; word-wrap: break-word;">${member.name}</h4>
                            ${member.nickname ? `<p class="secondary-info" style="margin: 0 0 var(--space-4) 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">"${member.nickname}"</p>` : ''}
                            <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">${member.age} years old</p>
                        </div>
                    </div>
                    
                    <div class="secondary-info" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-8); margin-bottom: var(--space-16); font-size: var(--font-size-sm);">
                        <div>
                            <strong>Height:</strong> ${member.height_cm}cm
                        </div>
                        <div>
                            <strong>Weight:</strong> ${member.weight_kg}kg
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <strong>BMI:</strong> ${member.bmi}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-16);">
                        <div class="status" style="background: rgba(${abilityColorValues}, 0.15); color: rgb(${abilityColorValues}); border-color: rgba(${abilityColorValues}, 0.25);">
                            ${abilityText} (${member.overall_ability}/10)
                        </div>
                    </div>
                    
                    ${member.special_needs.length > 0 ? `
                        <div style="margin-bottom: var(--space-16); font-size: var(--font-size-sm);">
                            <strong>Special Needs:</strong> ${member.special_needs.join(', ')}
                        </div>
                    ` : ''}
                    
                    ${member.allergies ? `
                        <div style="margin-bottom: var(--space-16); font-size: var(--font-size-sm); color: var(--color-warning);">
                            <strong>⚠️ Allergies:</strong> ${member.allergies}
                        </div>
                    ` : ''}
                    
                    <div class="secondary-info" style="margin-bottom: var(--space-16); font-size: var(--font-size-sm);">
                        <strong>Interests:</strong> ${member.interests.slice(0, 3).join(', ')}${member.interests.length > 3 ? '...' : ''}
                    </div>
                    
                    <div class="flex gap-8" style="flex-wrap: wrap;">
                        <button class="btn btn--outline btn--sm" onclick="editMemberPage(${member.id})">Edit</button>
                        <button class="btn btn--outline btn--sm" onclick="duplicateMember(${member.id})">Duplicate</button>
                        <button class="btn btn--outline btn--sm" style="color: var(--color-error); border-color: var(--color-error);" onclick="removeMember(${member.id})">Remove</button>
                    </div>
                </div>
            `;
        }
        
        function updateGroupSummary() {
            const totalMembers = document.getElementById('totalMembers');
            const ageRange = document.getElementById('ageRange');
            const avgAbility = document.getElementById('avgAbility');
            const getRecommendationsBtn = document.getElementById('getRecommendationsBtn');
            
            totalMembers.textContent = groupMembers.length;
            
            if (groupMembers.length === 0) {
                ageRange.textContent = '-';
                avgAbility.textContent = '-';
                getRecommendationsBtn.disabled = true;
            } else {
                const ages = groupMembers.map(m => m.age);
                const minAge = Math.min(...ages);
                const maxAge = Math.max(...ages);
                ageRange.textContent = minAge === maxAge ? `${minAge}` : `${minAge}-${maxAge}`;
                
                const totalAbility = groupMembers.reduce((sum, m) => sum + m.overall_ability, 0);
                avgAbility.textContent = Math.round(totalAbility / groupMembers.length * 10) / 10;
                
                getRecommendationsBtn.disabled = false;
            }
        }
        
        function editMemberPage(memberId) {
            editingMemberId = memberId;
            const member = groupMembers.find(m => m.id === memberId);
            
            // Update page title and breadcrumb
            document.getElementById('memberFormTitle').textContent = 'Edit Member';
            document.getElementById('memberFormBreadcrumb').textContent = 'Edit Member';
            
            // Populate form with member data
            const form = document.getElementById('memberPageForm');
            populateMemberPageForm(form, member);
            
            showView('member-form');
        }
        
        function duplicateMember(memberId) {
            const memberToDuplicate = groupMembers.find(m => m.id === memberId);
            if (!memberToDuplicate) {
                alert('Member not found!');
                return;
            }
            
            // Create a copy with new ID and modified name
            const duplicatedMember = {
                ...memberToDuplicate,
                id: Date.now(),
                name: memberToDuplicate.name + ' (Copy)',
                nickname: memberToDuplicate.nickname ? memberToDuplicate.nickname + ' Copy' : ''
            };
            
            groupMembers.push(duplicatedMember);
            renderGroupMembers();
            
        }
        
        function populateMemberPageForm(form, member) {
            const formData = new FormData(form);
            
            // Basic info
            form.name.value = member.name;
            form.nickname.value = member.nickname || '';
            form.date_of_birth.value = member.date_of_birth;
            form.gender.value = member.gender || '';
            
            // Physical characteristics
            form.height_cm.value = member.height_cm;
            form.weight_kg.value = member.weight_kg;
            form.bmi.value = member.bmi;
            
            // Abilities
            form.overall_ability.value = member.overall_ability;
            form.fine_motor.value = member.motor_skills?.fine || 5;
            form.gross_motor.value = member.motor_skills?.gross || 5;
            form.endurance.value = member.physical_capabilities?.endurance || 5;
            form.strength.value = member.physical_capabilities?.strength || 5;
            form.flexibility.value = member.physical_capabilities?.flexibility || 5;
            form.balance.value = member.physical_capabilities?.balance || 5;
            form.reading_level.value = member.cognitive_abilities?.reading_level || 'Pre-reader';
            form.math_skills.value = member.cognitive_abilities?.math_skills || 'Basic counting';
            form.problem_solving.value = member.cognitive_abilities?.problem_solving || 5;
            form.group_interaction.value = member.social_skills?.group_interaction || 5;
            form.leadership.value = member.social_skills?.leadership || 5;
            
            // Special considerations
            const specialNeedsCheckboxes = form.querySelectorAll('input[name="special_needs"]');
            specialNeedsCheckboxes.forEach(checkbox => {
                checkbox.checked = member.special_needs?.includes(checkbox.value) || false;
            });
            
            form.allergies.value = member.allergies || '';
            form.medical_conditions.value = member.medical_conditions || '';
            
            // Interests
            const interestCheckboxes = form.querySelectorAll('input[name="interests"]');
            interestCheckboxes.forEach(checkbox => {
                checkbox.checked = member.interests?.includes(checkbox.value) || false;
            });
            
            form.activity_preference.value = member.activity_preference || 'Both';
            form.energy_level.value = member.energy_level || 'Moderate';
        }
        
        function saveMemberFromPage(formData) {
            const member = {
                id: editingMemberId || Date.now(),
                name: formData.get('name'),
                nickname: formData.get('nickname'),
                date_of_birth: formData.get('date_of_birth'),
                age: calculateAge(formData.get('date_of_birth')),
                gender: formData.get('gender'),
                height_cm: parseInt(formData.get('height_cm')),
                weight_kg: parseFloat(formData.get('weight_kg')),
                bmi: calculateBMI(parseInt(formData.get('height_cm')), parseFloat(formData.get('weight_kg'))),
                overall_ability: parseInt(formData.get('overall_ability')),
                ability: parseInt(formData.get('overall_ability')),
                physical_ability: parseInt(formData.get('overall_ability')),
                motor_skills: {
                    fine: parseInt(formData.get('fine_motor')),
                    gross: parseInt(formData.get('gross_motor'))
                },
                physical_capabilities: {
                    endurance: parseInt(formData.get('endurance')),
                    strength: parseInt(formData.get('strength')),
                    flexibility: parseInt(formData.get('flexibility')),
                    balance: parseInt(formData.get('balance'))
                },
                cognitive_abilities: {
                    reading_level: formData.get('reading_level'),
                    math_skills: formData.get('math_skills'),
                    problem_solving: parseInt(formData.get('problem_solving'))
                },
                social_skills: {
                    group_interaction: parseInt(formData.get('group_interaction')),
                    leadership: parseInt(formData.get('leadership'))
                },
                special_needs: formData.getAll('special_needs').concat(
                    formData.get('other_special_needs') ? [formData.get('other_special_needs')] : []
                ),
                allergies: formData.get('allergies'),
                medical_conditions: formData.get('medical_conditions'),
                interests: formData.getAll('interests'),
                activity_preference: formData.get('activity_preference'),
                energy_level: formData.get('energy_level')
            };
            
            if (editingMemberId) {
                const index = groupMembers.findIndex(m => m.id === editingMemberId);
                groupMembers[index] = member;
                window.groupMembers = groupMembers;
            } else {
                groupMembers.push(member);
                window.groupMembers = groupMembers;
            }
            
            // ADD THESE LINES to refresh the display and show success
            renderGroupMembers();
            
            // Reset the form
            document.getElementById('memberPageForm').reset();
            
            // Reset editing state
            editingMemberId = null;
            
            // Show success message
            alert('Member saved successfully!');
            
            // Switch back to My Group view to see the new member
            showView('my-group');
        }
        
        function setupMemberPageForm() {
            // Reset form for new member
            editingMemberId = null;
            document.getElementById('memberFormTitle').textContent = 'Add New Member';
            document.getElementById('memberFormBreadcrumb').textContent = 'Add Member';
            document.getElementById('memberPageForm').reset();
        }
        
        function removeMember(memberId) {
            if (confirm('Are you sure you want to remove this member?')) {
                groupMembers = groupMembers.filter(m => m.id !== memberId);
                window.groupMembers = groupMembers;
                renderGroupMembers();
            }
        }
        
        function getPersonalizedRecommendations() {
            if (groupMembers.length === 0) {
                alert('Please add group members first to get personalized recommendations.');
                return;
            }
            
            // Show personalized filtering demo
            const ages = groupMembers.map(m => m.age);
            const minAge = Math.min(...ages);
            const maxAge = Math.max(...ages);
            const avgAbility = groupMembers.reduce((sum, m) => sum + m.overall_ability, 0) / groupMembers.length;
            const allSpecialNeeds = [...new Set(groupMembers.flatMap(m => m.special_needs))];
            const allAllergies = [...new Set(groupMembers.map(m => m.allergies).filter(a => a))];
            const allInterests = [...new Set(groupMembers.flatMap(m => m.interests))];
            
            let message = `\ud83e\udd16 ML Recommendation System Analysis:\n\n`;
            message += `👶 Age filtering: Activities suitable for ages ${minAge}-${maxAge}\n`;
            message += `💪 Ability matching: Targeting ${getAbilityLevelText(Math.round(avgAbility))} level (${Math.round(avgAbility)}/10)\n`;
            
            if (allSpecialNeeds.length > 0) {
                message += `⚕️ Special needs considered: ${allSpecialNeeds.join(', ')}\n`;
            }
            
            if (allAllergies.length > 0) {
                message += `⚠️ Allergy filters: Excluding activities with ${allAllergies.join(', ')}\n`;
            }
            
            message += `🎯 Interest boost: Prioritizing ${allInterests.slice(0, 3).join(', ')} activities\n\n`;
            message += `Found 12 personalized activity recommendations! (This would show filtered and ranked results)`;
            
            alert(message);
        }
        
        // Navigation
        function showView(viewId) {
            views.forEach(view => view.classList.remove('active'));
            navLinks.forEach(link => link.classList.remove('active'));

            document.getElementById(viewId).classList.add('active');
            const activeLink = document.querySelector(`[data-view="${viewId}"]`);
            if (activeLink) activeLink.classList.add('active');

            // Load view-specific content
            if (viewId === 'home') {
                renderFeaturedActivities();
            } else if (viewId === 'search') {
                renderActivities(currentActivities);
            } else if (viewId === 'calendar') {
                renderCalendar();
            } else if (viewId === 'my-group') {
                renderGroupMembers();
            } else if (viewId === 'member-form') {
                if (!editingMemberId) {
                    setupMemberPageForm();
                }
                // Setup event listeners after a small delay to ensure DOM is ready
                setTimeout(setupMemberFormEventListeners, 100);
            }
        }

        // Event listeners for navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const viewId = link.dataset.view;
                
                // Check if user needs to be logged in (Guest Mode users can access all views)
                if ((viewId === 'add-activity' || viewId === 'profile' || viewId === 'my-group') && !isLoggedIn && !isGuestMode) {
                    showView('login');
                    return;
                }
                
                showView(viewId);
            });
        });

        // Activity card rendering
        function createActivityCard(activity, includeActions = true) {
            const seasonText = Array.isArray(activity.season) ? activity.season.join(', ') : activity.season;
            const materialsText = Array.isArray(activity.materials_needed) ? activity.materials_needed.join(', ') : activity.materials_needed;
            
            return `
                <div class="activity-card">
                    <div class="activity-header">
                        <h3 class="activity-title">${activity.title}</h3>
                        <div class="meta-badge">${activity.indoor_outdoor}</div>
                    </div>
                    <div class="activity-meta">
                        <div class="meta-badge">Ages ${activity.age_min}-${activity.age_max}</div>
                        <div class="meta-badge">${activity.duration_mins} mins</div>
                        <div class="meta-badge">${activity.cost}</div>
                        <div class="meta-badge">${activity.players} players</div>
                    </div>
                    <div class="activity-tags">
                        ${activity.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    ${includeActions ? `
                    <div class="activity-actions">
                        <button class="btn btn--outline btn--sm" onclick="viewActivityDetails('${activity.title}')">View Details</button>
                        <button class="btn btn--primary btn--sm" onclick="addToPlan('${activity.title}')">Add to Plan</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function renderActivities(activities) {
            const grid = document.getElementById('activitiesGrid');
            if (activities.length === 0) {
                grid.innerHTML = '<p>No activities found matching your criteria.</p>';
                return;
            }
            grid.innerHTML = activities.map(activity => createActivityCard(activity)).join('');
        }

        function renderFeaturedActivities() {
            const grid = document.getElementById('featuredActivities');
            grid.innerHTML = sampleActivities.slice(0, 3).map(activity => createActivityCard(activity)).join('');
        }

        // Activity details modal
        function viewActivityDetails(title) {
            const activity = sampleActivities.find(a => a.title === title);
            if (!activity) return;

            const titleElement = document.getElementById('activityDetailsTitle');
            const breadcrumbElement = document.getElementById('activityDetailsBreadcrumb');
            const contentElement = document.getElementById('activityDetailsContent');

            titleElement.textContent = activity.title;
            breadcrumbElement.textContent = activity.title;
            
            const seasonText = Array.isArray(activity.season) ? activity.season.join(', ') : activity.season;
            const materialsText = Array.isArray(activity.materials_needed) ? activity.materials_needed.join(', ') : activity.materials_needed;
            
            contentElement.innerHTML = `
                <div class="activity-meta" style="margin-bottom: var(--space-16);">
                    <div class="meta-badge">Ages ${activity.age_min}-${activity.age_max}</div>
                    <div class="meta-badge">${activity.duration_mins} minutes</div>
                    <div class="meta-badge">${activity.cost}</div>
                    <div class="meta-badge">${activity.indoor_outdoor}</div>
                    <div class="meta-badge">${activity.players} players</div>
                </div>
                
                <div class="activity-tags" style="margin-bottom: var(--space-20);">
                    ${activity.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                
                <h4>How to Play</h4>
                <p style="margin-bottom: var(--space-16);">${activity.how_to_play}</p>
                
                <h4>Materials Needed</h4>
                <p style="margin-bottom: var(--space-16);">${materialsText}</p>
                
                <h4>Seasons</h4>
                <p style="margin-bottom: var(--space-16);">${seasonText}</p>
                
                ${activity.parent_caution ? `
                    <h4>Parent Caution</h4>
                    <p style="background: var(--color-bg-4); padding: var(--space-12); border-radius: var(--radius-base); margin-bottom: var(--space-16);">
                        ${activity.parent_caution}
                    </p>
                ` : ''}
                
                <div class="flex gap-8">
                    <button class="btn btn--primary" onclick="addToPlan('${activity.title}')">Add to My Plan</button>
                    ${isLoggedIn ? `<button class="btn btn--outline" onclick="editActivity('${activity.title}')">Edit Activity</button>` : ''}
                </div>
            `;

            showView('activity-details');
        }

        function addToPlan(title) {
            // Activity added silently
        }

        function editActivity(title) {
            alert(`Edit functionality for "${title}" would be implemented here.`);
        }

        // Login/logout functionality
        function login() {
            isLoggedIn = true;
            isGuestMode = false;
            loginNavBtn.classList.add('hidden');
            userInfo.classList.remove('hidden');
            document.getElementById('guestInfo').classList.add('hidden');
            document.getElementById('myGroupNavLink').style.display = 'block';
            document.getElementById('guestModeBanner').classList.add('hidden');
            
            // Load sample data for demo
            if (groupMembers.length === 0) {
                groupMembers = [...sampleGroupMembers];
            }
            
            showView('home');
        }

        function logout() {
            isLoggedIn = false;
            userInfo.classList.add('hidden');
            loginNavBtn.classList.remove('hidden');
            document.getElementById('myGroupNavLink').style.display = 'block';
            
            // Auto-switch to guest mode
            startGuestMode();
        }
        
        function startGuestMode() {
            isGuestMode = true;
            isLoggedIn = false;
            const dashboardElement = document.getElementById('dashboard');
            if (dashboardElement) {
                dashboardElement.classList.add('active');
            }
            console.log('Guest mode activated');
            // Update UI for guest mode
            loginNavBtn.classList.add('hidden');
            document.getElementById('guestInfo').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('myGroupNavLink').style.display = 'block';
            document.getElementById('guestModeBanner').classList.remove('hidden');
            
            // Pre-populate with sample data if empty
            if (groupMembers.length === 0) {
                groupMembers = [...sampleGroupMembers];
            }
            
            console.log('Guest mode started with', groupMembers.length, 'sample members');
        }

        // Auth tab switching
        function switchAuthTab(tabName) {
            const tabs = document.querySelectorAll('.auth-tab');
            const contents = document.querySelectorAll('.auth-content');
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.style.borderBottomColor = 'transparent';
                tab.style.color = 'var(--color-text-secondary)';
            });
            
            contents.forEach(content => {
                content.classList.add('hidden');
            });
            
            const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
            const activeContent = document.getElementById(`${tabName}TabContent`);
            
            activeTab.classList.add('active');
            activeTab.style.borderBottomColor = 'var(--color-primary)';
            activeTab.style.color = 'var(--color-primary)';
            activeContent.classList.remove('hidden');
            
            // Update switch text
            const switchText = document.getElementById('switchText');
            const switchLink = document.getElementById('switchAuthMode');
            
            if (tabName === 'login') {
                switchText.innerHTML = 'Don\'t have an account? <a href="#" id="switchAuthMode" style="color: var(--color-primary); font-weight: var(--font-weight-medium);">Register</a>';
            } else {
                switchText.innerHTML = 'Already have an account? <a href="#" id="switchAuthMode" style="color: var(--color-primary); font-weight: var(--font-weight-medium);">Login</a>';
            }
            
            // Re-attach event listener to new link
            document.getElementById('switchAuthMode').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab(tabName === 'login' ? 'register' : 'login');
            });
        }

        // Search functionality
        function performSearch(query = '') {
            let filtered = [...sampleActivities];

            // Text search
            if (query) {
                const searchTerm = query.toLowerCase();
                filtered = filtered.filter(activity => 
                    activity.title.toLowerCase().includes(searchTerm) ||
                    activity.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    activity.how_to_play.toLowerCase().includes(searchTerm)
                );
            }

            // Apply filters
            const minAge = parseInt(document.getElementById('minAge').value);
            const maxAge = parseInt(document.getElementById('maxAge').value);
            const duration = document.getElementById('durationFilter').value;
            const cost = document.getElementById('costFilter').value;
            const season = document.getElementById('seasonFilter').value;
            const players = document.getElementById('playersFilter').value;
            const indoorOutdoor = document.querySelector('.toggle-btn.active[data-filter="indoor_outdoor"]').dataset.value;

            filtered = filtered.filter(activity => {
                // Age range filter
                if (activity.age_min > maxAge || activity.age_max < minAge) return false;
                
                // Duration filter
                if (duration && activity.duration_mins < parseInt(duration)) return false;
                
                // Cost filter
                if (cost && activity.cost !== cost) return false;
                
                // Indoor/Outdoor filter
                if (indoorOutdoor && activity.indoor_outdoor !== indoorOutdoor) return false;
                
                // Season filter
                if (season) {
                    const activitySeasons = Array.isArray(activity.season) ? activity.season : [activity.season];
                    if (!activitySeasons.includes(season) && !activitySeasons.includes('All seasons')) return false;
                }
                
                return true;
            });

            currentActivities = filtered;
            renderActivities(filtered);
        }

        // Initialize group members array
        window.groupMembers = [];
        
        // Group member management functions
        function addGroupMember(memberData) {
            if (!window.groupMembers) {
                window.groupMembers = [];
            }
            window.groupMembers.push(memberData);
            console.log('Added member:', memberData);
            console.log('Total members:', window.groupMembers.length);
        }
        
        function saveMemberFromPage(formData) {
            const member = {
                name: formData.get('name'),
                age: calculateAge(formData.get('date_of_birth')),
                ability: parseInt(formData.get('physical_ability')) || 5,
                interests: formData.getAll('interests')
            };
            addGroupMember(member);
            alert('Member added successfully!');
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            logoutBtn.addEventListener('click', logout);



            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchAuthTab(tab.dataset.tab);
                });
            });

            // Auth forms
            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Simple validation for demo
                if (email && password) {
                    login();
                } else {
                    alert('Please fill in all fields');
                }
            });
            
            document.getElementById('registerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                
                // Simple validation for demo
                if (!name || !email || !password || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                if (!agreeTerms) {
                    alert('Please agree to the terms and conditions');
                    return;
                }

                login();
            });

            // Initial switch auth mode listener
            document.getElementById('switchAuthMode').addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('register');
            });

            // Search inputs
            document.getElementById('searchInput').addEventListener('input', (e) => {
                performSearch(e.target.value);
            });
            
            document.getElementById('mainSearchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    showView('search');
                    document.getElementById('searchInput').value = e.target.value;
                    performSearch(e.target.value);
                }
            });

            // Filter controls
            document.getElementById('minAge').addEventListener('input', (e) => {
                document.getElementById('minAgeValue').textContent = e.target.value;
                performSearch(document.getElementById('searchInput').value);
            });
            
            document.getElementById('maxAge').addEventListener('input', (e) => {
                document.getElementById('maxAgeValue').textContent = e.target.value;
                performSearch(document.getElementById('searchInput').value);
            });

            // Filter dropdowns
            ['durationFilter', 'costFilter', 'seasonFilter', 'playersFilter'].forEach(id => {
                document.getElementById(id).addEventListener('change', () => {
                    performSearch(document.getElementById('searchInput').value);
                });
            });

            // Toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const filter = e.target.dataset.filter;
                    const value = e.target.dataset.value;
                    
                    // Remove active from siblings
                    document.querySelectorAll(`[data-filter="${filter}"]`).forEach(sibling => {
                        sibling.classList.remove('active');
                    });
                    
                    // Add active to clicked button
                    e.target.classList.add('active');
                    
                    performSearch(document.getElementById('searchInput').value);
                });
            });

            // Add activity form
            document.getElementById('addActivityForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                
                const newActivity = {
                    title: formData.get('title'),
                    age_min: parseInt(formData.get('age_min')),
                    age_max: parseInt(formData.get('age_max')),
                    duration_mins: parseInt(formData.get('duration')),
                    cost: formData.get('cost'),
                    indoor_outdoor: formData.get('indoor_outdoor'),
                    season: formData.getAll('season'),
                    players: formData.get('players') || '1+',
                    tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                    materials_needed: formData.get('materials').split(',').map(m => m.trim()),
                    how_to_play: formData.get('instructions'),
                    parent_caution: formData.get('caution') || ''
                };
                
                // Add to activities list
                sampleActivities.push(newActivity);

                e.target.reset();
            });

            // Save draft button
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                // Draft saved silently
            });


            
            // Member page form submission
            document.getElementById('memberPageForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                
                // Validation
                if (!formData.get('name') || !formData.get('date_of_birth') || 
                    !formData.get('height_cm') || !formData.get('weight_kg')) {
                    alert('Please fill in all required fields (marked with *)');
                    return;
                }
                
                const height = parseInt(formData.get('height_cm'));
                const weight = parseFloat(formData.get('weight_kg'));
                const birthDate = new Date(formData.get('date_of_birth'));
                const today = new Date();
                
                if (height < 50 || height > 250) {
                    alert('Height must be between 50-250 cm');
                    return;
                }
                
                if (weight < 5 || weight > 200) {
                    alert('Weight must be between 5-200 kg');
                    return;
                }
                
                if (birthDate > today) {
                    alert('Date of birth cannot be in the future');
                    return;
                }
                
                const age = calculateAge(formData.get('date_of_birth'));
                if (age > 100) {
                    alert('Age must be between 0-100');
                    return;
                }
                
                saveMemberFromPage(formData);
            });
            
            // BMI auto-calculation for member page form
            function updateBMIPage() {
                const height = document.querySelector('#memberPageForm input[name="height_cm"]')?.value;
                const weight = document.querySelector('#memberPageForm input[name="weight_kg"]')?.value;
                const bmiField = document.querySelector('#memberPageForm input[name="bmi"]');
                
                if (height && weight && bmiField) {
                    const bmi = calculateBMI(parseInt(height), parseFloat(weight));
                    bmiField.value = bmi;
                }
            }            

            // Range slider value display updates - for main view ranges
            function updateRangeDisplay(rangeInput, displayElement = null) {
                const value = rangeInput.value;
                const label = rangeInput.previousElementSibling;
                if (label && label.classList.contains('form-label')) {
                    const baseText = label.textContent.split('(')[0].trim();
                    label.textContent = `${baseText} (${value})`;
                }
            }
            
            // Add range input listeners for search filters
            document.querySelectorAll('#search input[type="range"]').forEach(range => {
                range.addEventListener('input', (e) => {
                    updateRangeDisplay(e.target);
                });
                
                // Initialize display
                updateRangeDisplay(range);
            });
            
            // Setup range listeners for member form when it becomes active
            function setupMemberFormRangeListeners() {
                const memberForm = document.getElementById('member-form');
                if (memberForm) {
                    memberForm.querySelectorAll('input[type="range"]').forEach(range => {
                        // Remove existing listeners to avoid duplicates
                        range.removeEventListener('input', updateMemberFormRangeDisplays);
                        range.addEventListener('input', (e) => {
                            const value = e.target.value;
                            const label = e.target.previousElementSibling;
                            if (label && label.classList.contains('form-label')) {
                                const baseText = label.textContent.split('(')[0].trim();
                                label.textContent = `${baseText} (${value})`;
                            }
                        });
                        
                        // Initialize display
                        const value = range.value;
                        const label = range.previousElementSibling;
                        if (label && label.classList.contains('form-label')) {
                            const baseText = label.textContent.split('(')[0].trim();
                            label.textContent = `${baseText} (${value})`;
                        }
                    });
                }
            }
            
            // Get Recommendations button
            document.getElementById('getRecommendationsBtn').addEventListener('click', getPersonalizedRecommendations);

            // Guest mode tooltip functionality
            const guestBadge = document.getElementById('guestBadge');
            const guestTooltip = document.getElementById('guestTooltip');
            
            if (guestBadge && guestTooltip) {
                guestBadge.addEventListener('mouseenter', () => {
                    guestTooltip.classList.remove('hidden');
                });
                
                guestBadge.addEventListener('mouseleave', () => {
                    guestTooltip.classList.add('hidden');
                });
            }
            
            // Auto-start in guest mode on first load
            startGuestMode();

            // Load activities from CSV and initialize display
            loadActivitiesFromCSV();

            // Initialize range displays
            setTimeout(() => {
                document.querySelectorAll('input[type="range"]').forEach(range => {
                    updateRangeDisplay(range);
                });
            }, 100);
        });
        
        // Global functions for onclick handlers
        window.editMemberPage = editMemberPage;
        window.duplicateMember = duplicateMember;
        window.removeMember = removeMember;
        window.addMemberTemplate = addMemberTemplate;
        window.getPersonalizedRecommendations = getPersonalizedRecommendations;
        window.setupMemberPageForm = setupMemberPageForm;
        window.addToPlan = addToPlan;
        window.exportToICS = exportToICS;
        window.exportToCSV = exportToCSV;
        window.exportToPDF = exportToPDF;
        
        // Setup BMI calculation for member form when view is shown
        function setupMemberFormEventListeners() {
            const heightInput = document.querySelector('#member-form input[name="height_cm"]');
            const weightInput = document.querySelector('#member-form input[name="weight_kg"]');
            
            if (heightInput && weightInput) {
                heightInput.addEventListener('input', updateBMIPage);
                weightInput.addEventListener('input', updateBMIPage);
            }
            
            // Setup range sliders
            setupMemberFormRangeListeners();
        }
    </script>
    <script src="/static/api-integration.js"></script>
    </div>
</body>
</html>